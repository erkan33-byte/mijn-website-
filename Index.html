<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <title>BTC Key Generator + Balance Check (Test)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Roboto, Helvetica, Arial; max-width:820px; margin:32px auto; padding:0 16px; color:#111; }
    h1{margin-bottom:4px}
    .card{border:1px solid #ddd; padding:16px; border-radius:8px; margin-top:12px;}
    label{display:block; margin:8px 0 4px; font-weight:600}
    textarea,input{width:100%; box-sizing:border-box; padding:8px; font-family:monospace}
    button{padding:10px 14px; margin-top:8px; cursor:pointer;}
    .small{font-size:0.9rem; color:#555}
    .danger{color:#a00; font-weight:700}
    .row{display:flex; gap:8px}
    .col{flex:1}
  </style>
  <!-- bibliotheken via CDN -->
  <script src="https://unpkg.com/bitcoinjs-lib@6.1.0/dist/bitcoinjs-lib.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
  <h1>BTC key generator + saldo check</h1>
  <p class="small">Dit is een demo: maakt in de browser een private key en adres en checkt het saldo via publieke API's.</p>

  <div class="card">
    <label>Random Private Key (WIF)</label>
    <textarea id="wif" rows="2" readonly></textarea>

    <label>Public Address (P2PKH)</label>
    <input id="address" readonly />

    <div class="row">
      <div class="col"><button id="generate">Generate new keypair</button></div>
      <div class="col"><button id="check">Check saldo</button></div>
    </div>

    <p class="small">Balance: <span id="balance">—</span></p>
    <p class="small">Confirmed sats: <span id="confirmed">—</span> · Unconfirmed sats: <span id="unconfirmed">—</span></p>

    <div style="margin-top:10px">
      <label>Raw API response (debug)</label>
      <textarea id="apiresp" rows="6" readonly></textarea>
    </div>

    <p class="danger small">⚠️ Let op: dit is enkel educatief. Gebruik dit nooit voor echte bitcoins!</p>
  </div>

  <script>
    const bitcoin = window.bitcoinjsLib;
    const NETWORK = bitcoin.networks.testnet; // ⚠️ TESTNET

    function generateKeyPair() {
      const keyPair = bitcoin.ECPair.makeRandom({ network: NETWORK });
      const { publicKey } = keyPair;
      const { address } = bitcoin.payments.p2pkh({ pubkey: publicKey, network: NETWORK });
      const wif = keyPair.toWIF();
      return { address, wif };
    }

    function setGenerated(addr, wif) {
      document.getElementById('address').value = addr;
      document.getElementById('wif').value = wif;
      document.getElementById('balance').innerText = '—';
      document.getElementById('confirmed').innerText = '—';
      document.getElementById('unconfirmed').innerText = '—';
      document.getElementById('apiresp').value = '';
    }

    document.getElementById('generate').addEventListener('click', () => {
      const { address, wif } = generateKeyPair();
      setGenerated(address, wif);
    });

    async function checkBalance(addr) {
      document.getElementById('balance').innerText = 'checking...';
      const url = `https://blockstream.info/testnet/api/address/${addr}`;
      const r = await axios.get(url);
      const cs = r.data.chain_stats || {};
      const ms = r.data.mempool_stats || {};
      const funded = (cs.funded_txo_sum || 0) + (ms.funded_txo_sum || 0);
      const spent  = (cs.spent_txo_sum  || 0) + (ms.spent_txo_sum  || 0);
      const confirmed = (cs.funded_txo_sum || 0) - (cs.spent_txo_sum || 0);
      const unconfirmed = funded - spent - confirmed;
      return { raw: r.data, confirmed, unconfirmed, total: confirmed + unconfirmed };
    }

    document.getElementById('check').addEventListener('click', async () => {
      const addr = document.getElementById('address').value.trim();
      if (!addr) return alert('Genereer eerst een keypair.');
      try {
        const res = await checkBalance(addr);
        document.getElementById('balance').innerText = res.total + ' sats';
        document.getElementById('confirmed').innerText = res.confirmed + ' sats';
        document.getElementById('unconfirmed').innerText = res.unconfirmed + ' sats';
        document.getElementById('apiresp').value = JSON.stringify(res.raw, null, 2);
      } catch (err) {
        document.getElementById('balance').innerText = 'API fout';
        document.getElementById('apiresp').value = err.toString();
      }
    });

    (function init() {
      const { address, wif } = generateKeyPair();
      setGenerated(address, wif);
    })();
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>BTC Key Generator + Balance Check</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bitcoinjs-lib/3.3.2/bitcoinjs.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; font-size: 14px; }
    th { background-color: #f2f2f2; }
    tr.found { background-color: #d4edda; font-weight: bold; }
    .status { margin-top: 10px; font-weight: bold; }
    button { margin: 5px; padding: 8px 12px; font-size: 14px; }
  </style>
</head>
<body>
  <h2>BTC Key Generator + Balance Check</h2>
  <button id="startBtn">ðŸš€ Start zoeken</button>
  <button id="stopBtn">â›” Stoppen</button>
  <div class="status" id="status">Nog niet gestart...</div>
  
  <table id="resultTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Adres</th>
        <th>Balans (satoshi)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const statusEl = document.getElementById("status");
    const tableBody = document.querySelector("#resultTable tbody");

    let searching = false;
    let counter = 0;

    async function checkBalance(address) {
      const url = `https://api.blockcypher.com/v1/btc/main/addrs/${address}/balance`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        return data.final_balance || 0;
      } catch {
        return 0;
      }
    }

    async function generateAndCheck() {
      const keyPair = bitcoin.ECPair.makeRandom();
      const { address } = bitcoin.payments.p2pkh({ pubkey: keyPair.publicKey });
      const wif = keyPair.toWIF();

      counter++;
      const balance = await checkBalance(address);

      // rij toevoegen
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${counter}</td>
        <td>${address}</td>
        <td>${balance}</td>
      `;
      tableBody.appendChild(row);

      if (balance > 0) {
        row.classList.add("found");
        statusEl.textContent = `ðŸŽ‰ GEVONDEN! Adres: ${address} | Private Key: ${wif}`;
        searching = false;
        return true;
      }
      return false;
    }

    async function searchLoop() {
      if (!searching) return;
      statusEl.textContent = `ðŸ”Ž Zoeken... (${counter} pogingen gedaan)`;
      const found = await generateAndCheck();
      if (!found && searching) {
        setTimeout(searchLoop, 500);
      }
    }

    startBtn.addEventListener("click", () => {
      if (!searching) {
        searching = true;
        counter = 0;
        tableBody.innerHTML = ""; // tabel leegmaken
        statusEl.textContent = "ðŸš€ Start zoeken...";
        searchLoop();
      }
    });

    stopBtn.addEventListener("click", () => {
      searching = false;
      statusEl.textContent = "â›” Gestopt door gebruiker.";
    });
  </script>
</body>
</html>

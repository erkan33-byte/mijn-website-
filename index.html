<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<title>BTC Key Generator via Proxy</title>
<script src="https://unpkg.com/bitcoinjs-lib@6.1.0/dist/bitcoinjs-lib.min.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
#status { font-weight: bold; margin-bottom: 10px; }
#counter { font-weight: bold; margin-bottom: 10px; }
table { border-collapse: collapse; width: 100%; margin-top: 15px; }
th, td { border: 1px solid #999; padding: 5px; font-family: monospace; font-size: 13px; }
th { background: #eee; }
tr.found { background: #c8f7c5; }
button { margin-right: 10px; padding: 6px 12px; font-size: 14px; }
</style>
</head>
<body>
<h2>BTC Key Generator via Proxy</h2>

<div id="status">Nog niet gestartâ€¦</div>
<div id="counter">Aantal gescande adressen: 0</div>

<button id="startBtn">Start zoeken</button>
<button id="stopBtn">Stoppen</button>

<table id="resultsTable">
<thead>
<tr><th>#</th><th>Adres</th><th>Private Key (WIF)</th><th>Balance (satoshi)</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
const statusEl = document.getElementById("status");
const counterEl = document.getElementById("counter");
const tableBody = document.querySelector("#resultsTable tbody");

let searching = false;
let counter = 0;
const MAX_ROWS = 100;

// Genereer willekeurige private key
function generatePrivateKey() {
  const array = new Uint8Array(32);
  window.crypto.getRandomValues(array);
  return array;
}

// Private key â†’ public key + keyPair voor WIF
function privateKeyToKeyPair(privateKey) {
  return bitcoinjs.ECPair.fromPrivateKey(Buffer.from(privateKey));
}

// Public key â†’ Bitcoin adres
function keyPairToAddress(keyPair) {
  const { address } = bitcoinjs.payments.p2pkh({ pubkey: keyPair.publicKey });
  return address;
}

// âœ… Balans check via proxy
async function checkBalance(address) {
  try {
    const res = await fetch(`http://localhost:3000/balance/${address}`);
    const data = await res.json();
    return data.balance || 0;
  } catch (err) {
    console.error("Proxy error:", err);
    return 0;
  }
}

// Scan Ã©Ã©n adres
async function scanOnce() {
  counter++;
  counterEl.textContent = `Aantal gescande adressen: ${counter}`;

  const privKey = generatePrivateKey();
  const keyPair = privateKeyToKeyPair(privKey);
  const address = keyPairToAddress(keyPair);
  const wif = keyPair.toWIF();

  const balance = await checkBalance(address);

  const tr = document.createElement("tr");
  if (balance > 0) tr.classList.add("found");
  tr.innerHTML = `<td>${counter}</td><td>${address}</td><td>${wif}</td><td>${balance}</td>`;
  tableBody.appendChild(tr);

  // Stop bij saldo > 0
  if (balance > 0) {
    searching = false;
    statusEl.textContent = `ðŸŽ‰ FOUND! Address ${address} heeft ${balance} satoshi!`;
    return;
  }

  // Tabel reset bij > MAX_ROWS
  if (tableBody.rows.length > MAX_ROWS) {
    tableBody.innerHTML = "";
    counter = 0;
  }
}

// Loop functie
async function loop() {
  if (!searching) return;
  await scanOnce();
  if (searching) setTimeout(loop, 200);
}

// Knoppen
document.getElementById("startBtn").addEventListener("click", () => {
  if (!searching) {
    searching = true;
    statusEl.textContent = "ðŸ”Ž Zoeken gestartâ€¦";
    loop();
  }
});

document.getElementById("stopBtn").addEventListener("click", () => {
  searching = false;
  statusEl.textContent = "â›” Gestopt door gebruiker.";
});
</script>
</body>
</html>

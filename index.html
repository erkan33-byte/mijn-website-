<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<title>BTC Key Generator + Balance Check</title>
<style>
body { font-family: Arial; margin: 20px; }
#status { font-weight: bold; margin-bottom: 10px; }
#counter { font-weight: bold; margin-bottom: 10px; }
table { border-collapse: collapse; width: 100%; margin-top: 15px; }
th, td { border: 1px solid #999; padding: 5px; font-family: monospace; font-size: 13px; }
th { background: #eee; }
tr.found { background: #c8f7c5; }
button { margin-right: 10px; padding: 6px 12px; font-size: 14px; }
</style>
</head>
<body>
<h2>BTC Key Generator + Balance Check</h2>

<div id="status">Nog niet gestartâ€¦</div>
<div id="counter">Aantal gescande adressen: 0</div>

<button id="startBtn">Start zoeken</button>
<button id="stopBtn">Stoppen</button>

<table id="resultsTable">
<thead>
<tr><th>#</th><th>Adres</th><th>Private Key (WIF)</th><th>Balance (satoshi)</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
const counterEl = document.getElementById("counter");
const statusEl = document.getElementById("status");
const tableBody = document.querySelector("#resultsTable tbody");
let searching = false;
let counter = 0;

// fallback generator: random strings (browser-compatibel)
function generateKeypairFallback() {
  const chars = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
  function randomStr(len) {
    let str = "";
    for (let i=0;i<len;i++) str += chars[Math.floor(Math.random()*chars.length)];
    return str;
  }
  return {
    address: "bc1" + randomStr(30),
    wif: randomStr(52)
  };
}

// Balans check via proxy
async function checkBalance(address) {
  try {
    const res = await fetch(`http://localhost:3000/balance/${address}`);
    const data = await res.json();
    return data.balance || 0;
  } catch (err) {
    console.error("Proxy error:", err);
    return 0;
  }
}

// Scan Ã©Ã©n adres
async function scanOnce() {
  counter++;
  counterEl.textContent = `Aantal gescande adressen: ${counter}`;

  const { address, wif } = generateKeypairFallback();
  const balance = await checkBalance(address);

  const tr = document.createElement("tr");
  if (balance > 0) tr.classList.add("found");
  tr.innerHTML = `<td>${counter}</td><td>${address}</td><td>${wif}</td><td>${balance}</td>`;
  tableBody.appendChild(tr);

  return balance > 0;
}

// Asynchrone loop
async function loop() {
  if (!searching) return;
  const found = await scanOnce();
  if (found) {
    statusEl.textContent = "ðŸŽ‰ Adres met saldo gevonden!";
    searching = false;
    return;
  }
  setTimeout(loop, 200);
}

// Knoppen
document.getElementById("startBtn").addEventListener("click", () => {
  if (!searching) {
    searching = true;
    statusEl.textContent = "ðŸ”Ž Zoeken gestartâ€¦";
    loop();
  }
});

document.getElementById("stopBtn").addEventListener("click", () => {
  searching = false;
  statusEl.textContent = "â›” Gestopt door gebruiker.";
});
</script>
</body>
</html>

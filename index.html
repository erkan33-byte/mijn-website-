<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>BTC Key Generator (2 keys per batch, 4 adressen, volledige voortgang)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/elliptic/6.5.4/elliptic.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; word-break: break-all; }
th { background: #f2f2f2; }
button, input { margin-bottom: 10px; padding: 8px 12px; }
#totaal, #errors, #progress { margin-bottom: 10px; font-weight: bold; }
#foundMsg { margin-top: 15px; font-weight: bold; font-size: 16px; color: green; }
label { display:inline-block; min-width:150px; }
</style>
</head>
<body>
<h2>BTC Key Generator (2 keys per batch = 4 adressen, volledige voortgang)</h2>

<p><a href="index3.html" target="_blank" style="font-weight:bold; font-size:16px; color:blue; text-decoration:underline;">Ga naar index3.html</a></p>

<div id="totaal">Totaal gescande adressen: 0</div>
<div id="errors">Aantal errors: 0</div>
<div id="progress">Voortgang in keyspace: 0.0000000000000000000000000000000000000000000000000000000000000000000000000000 %</div>

<label for="stepKeysInput">Stapgrootte (keys per increment):</label>
<input type="text" id="stepKeysInput" value="1000000"><br>

<button id="startBtn">Start zoeken</button>
<button id="stopBtn" disabled>Stop</button>

<div id="foundMsg"></div>

<table id="resultTable">
<thead>
<tr>
<th>#</th>
<th>Adres</th>
<th>Type</th>
<th>WIF</th>
<th>Saldo (BTC)</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// ===== Helpers =====
function toHex(bytes){return Array.from(bytes).map(b=>b.toString(16).padStart(2,"0")).join("");}
function hexToBytes(hex){const out=new Uint8Array(hex.length/2);for(let i=0;i<out.length;i++) out[i]=parseInt(hex.substr(i*2,2),16);return out;}
function sha256Hex(hex){return CryptoJS.SHA256(CryptoJS.enc.Hex.parse(hex)).toString();}
function doubleSha256Hex(hex){return sha256Hex(sha256Hex(hex));}
function base58Encode(hex){
  const alphabet="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
  const bytes=hexToBytes(hex);let zeros=0;
  while(zeros<bytes.length&&bytes[zeros]===0) zeros++;
  let num=BigInt("0x"+hex);let out="";
  while(num>0n){let r=num%58n;num/=58n;out=alphabet[Number(r)]+out;}
  return "1".repeat(zeros)+(out||"");
}

// ===== Keyspace =====
const ORDER_N = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141n;
const MIN_KEY = 1n;
const MAX_VALID_KEY = ORDER_N-1n;
const KEYSPACE_SIZE = MAX_VALID_KEY;

// ===== Random key =====
function genRandomKeyBigInt(){
  const arr=new Uint8Array(32);
  crypto.getRandomValues(arr);
  let k=BigInt("0x"+Array.from(arr,b=>b.toString(16).padStart(2,"0")).join(""));
  if(k===0n) return 1n;
  if(k>MAX_VALID_KEY) k=(k % MAX_VALID_KEY)+1n;
  return k;
}

// ===== Variabelen =====
let counter=0,totaal=0,fouten=0,zoeken=false,MAX_VISIBLE=250,currentKey=null,stepKeys=1000000n;

// ===== Balance APIs via corsproxy.io =====
const balanceAPIs = [
  addr=>`https://corsproxy.io/?url=https://blockstream.info/api/address/${addr}`,
  addr=>`https://corsproxy.io/?url=https://mempool.space/api/address/${addr}`
];

// ===== Fetch met retries =====
async function fetchWithRetries(url){
  for(let attempt=0; attempt<2; attempt++){
    try{
      const controller=new AbortController();
      const timeout=setTimeout(()=>controller.abort(),2000);
      const resp=await fetch(url,{signal:controller.signal});
      clearTimeout(timeout);
      if(resp.ok) return await resp.json();
    }catch(e){}
    await new Promise(r=>setTimeout(r,20));
  }
  return null;
}

// ===== Check balance Ã©Ã©n adres met retry =====
async function checkBalance(address){
  while(true){
    let success=false;
    for(const api of balanceAPIs){
      const data = await fetchWithRetries(api(address));
      if(data){
        success=true;
        if(data.chain_stats) return (Number(data.chain_stats.funded_txo_sum||0)-Number(data.chain_stats.spent_txo_sum||0))/1e8;
        if(data.address && data.address.balance) return Number(data.address.balance)/1e8;
        if(data.data && data.data[address] && data.data[address].address && data.data[address].address.balance) return Number(data.data[address].address.balance)/1e8;
      }
    }
    if(success) break;
    fouten++; document.getElementById("errors").textContent="Aantal errors: "+fouten;
    await new Promise(r=>setTimeout(r,2000));
  }
}

// ===== Increment =====
function doIncrementStep(){currentKey+=stepKeys;if(currentKey>MAX_VALID_KEY) currentKey-=MAX_VALID_KEY;}

// ===== Voortgang in keyspace met 80 decimalen =====
function getProgress(){
  const prog = (currentKey-MIN_KEY)*100n*10n**80n/KEYSPACE_SIZE;
  let s = prog.toString().padStart(81,'0');
  s = s[0]+'.'+s.slice(1);
  return s + ' %';
}

// ===== Start / Stop =====
async function starten(){
  if(zoeken) return;
  stepKeys=BigInt(document.getElementById("stepKeysInput").value.trim()||"1000000");
  currentKey=genRandomKeyBigInt();
  zoeken=true;
  document.getElementById("startBtn").disabled=true;
  document.getElementById("stopBtn").disabled=false;
  document.getElementById("foundMsg").textContent="";
  genereerBatch();
}
function stoppen(){zoeken=false; document.getElementById("startBtn").disabled=false; document.getElementById("stopBtn").disabled=true;}
function resetTeller(){totaal=0;document.getElementById("totaal").textContent="Totaal gescande adressen: 0";}
function resetErrors(){fouten=0;document.getElementById("errors").textContent="Aantal errors: 0";}

// ===== Genereer batch =====
async function genereerBatch(){
  if(!zoeken) return;

  // 2 verschillende keys per batch
  const keys=[currentKey, genRandomKeyBigInt()];
  keys.forEach(doIncrementStep);

  const results=[];
  for(const k of keys){
    const privHex=k.toString(16).padStart(64,"0");
    const ec=new elliptic.ec("secp256k1"); 
    const kp=ec.keyFromPrivate(privHex,"hex");

    // Compressed
    const pubC=toHex(kp.getPublic(true,"array"));
    const ripemdC=CryptoJS.RIPEMD160(CryptoJS.enc.Hex.parse(sha256Hex(pubC))).toString();
    const payloadC="00"+ripemdC;
    const checksumC=doubleSha256Hex(payloadC).slice(0,8);
    const addressC=base58Encode(payloadC+checksumC);
    const wifC=base58Encode("80"+privHex+"01"+doubleSha256Hex("80"+privHex+"01").slice(0,8));

    // Uncompressed
    const pubU=toHex(kp.getPublic(false,"array"));
    const ripemdU=CryptoJS.RIPEMD160(CryptoJS.enc.Hex.parse(sha256Hex(pubU))).toString();
    const payloadU="00"+ripemdU;
    const checksumU=doubleSha256Hex(payloadU).slice(0,8);
    const addressU=base58Encode(payloadU+checksumU);
    const wifU=base58Encode("80"+privHex+doubleSha256Hex("80"+privHex).slice(0,8));

    results.push({addressC,wifC,addressU,wifU});
  }

  const tbody=document.querySelector("#resultTable tbody");
  for(const r of results){
    const saldoC = await checkBalance(r.addressC);
    const saldoU = await checkBalance(r.addressU);

    counter++; totaal++;
    let rowC=document.createElement("tr");
    rowC.innerHTML=`<td>${counter}</td><td>${r.addressC}</td><td>Compressed</td><td>${r.wifC}</td><td>${saldoC}</td>`;
    tbody.appendChild(rowC);

    counter++; totaal++;
    let rowU=document.createElement("tr");
    rowU.innerHTML=`<td>${counter}</td><td>${r.addressU}</td><td>Uncompressed</td><td>${r.wifU}</td><td>${saldoU}</td>`;
    tbody.appendChild(rowU);

    if(saldoC>0 || saldoU>0){
      document.getElementById("foundMsg").textContent="ðŸŽ‰ Adres gevonden met saldo >0 BTC!";
      zoeken=false;
      document.getElementById("startBtn").disabled=true;
      document.getElementById("stopBtn").disabled=true;
    }
  }

  while(tbody.rows.length>MAX_VISIBLE) tbody.deleteRow(0);

  document.getElementById("totaal").textContent="Totaal gescande adressen: "+totaal;
  document.getElementById("progress").textContent="Voortgang in keyspace: "+getProgress();

  if(zoeken) setTimeout(genereerBatch,1000); // wacht 1 sec tussen batches
}

document.getElementById("startBtn").addEventListener("click",starten);
document.getElementById("stopBtn").addEventListener("click",stoppen);
</script>
</body>
</html>

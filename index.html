<!DOCTYPE html>
<html>
<head>
  <title>BTC Key Generator</title>
  <script src="https://unpkg.com/bitcoinjs-lib@6.1.0/dist/bitcoinjs-lib.min.js"></script>
</head>
<body>
  <h3>Gegenereerde adressen:</h3>
  <pre id="output"></pre>
  <script>
    function generatePrivateKey() {
      const array = new Uint8Array(32);
      window.crypto.getRandomValues(array);
      return array;
    }

    function privateKeyToPublicKey(privateKey) {
      const keyPair = bitcoinjs.ECPair.fromPrivateKey(Buffer.from(privateKey));
      return keyPair.publicKey;
    }

    function publicKeyToAddress(publicKey) {
      const { address } = bitcoinjs.payments.p2pkh({ pubkey: publicKey });
      return address;
    }

    async function checkBalance(address) {
      const url = `https://api.blockcypher.com/v1/btc/main/addrs/${address}/balance`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        return data.final_balance || 0;
      } catch {
        return 0;
      }
    }

    async function generateBtcKeyWithBalanceCheck() {
      const output = document.getElementById('output');
      let count = 0;
      while (count < 5) { // 5 adressen als voorbeeld
        const privKey = generatePrivateKey();
        const pubKey = privateKeyToPublicKey(privKey);
        const address = publicKeyToAddress(pubKey);

        output.textContent += `Generated Address: ${address}\n`;

        const balance = await checkBalance(address);
        output.textContent += `Balance: ${balance} satoshi\n\n`;

        count++;
      }
    }

    generateBtcKeyWithBalanceCheck();
  </script>
</body>
</html>

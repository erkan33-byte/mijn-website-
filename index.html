<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>BTC Key Generator + Balance Check</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; padding: 8px 12px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background-color: #f2f2f2; }
    tr.found { background-color: #d4edda; font-weight: bold; }
  </style>
</head>
<body>
  <h2>BTC Key Generator + Balance Check</h2>
  <button id="startBtn">ðŸš€ Start zoeken</button>
  <button id="stopBtn">â›” Stoppen</button>
  <div id="status">Nog niet gestart...</div>
  
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Adres</th>
        <th>Private Key (WIF)</th>
        <th>Balans (satoshi)</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script type="module">
    import * as bitcoin from "https://esm.sh/bitcoinjs-lib";

    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const statusEl = document.getElementById("status");
    const tableBody = document.getElementById("tableBody");

    let running = false;
    let counter = 0;

    async function checkBalance(address) {
      const url = `https://blockchain.info/q/getreceivedbyaddress/${address}?cors=true`;
      try {
        const res = await fetch(url);
        const balance = await res.text();
        return parseInt(balance) || 0;
      } catch (e) {
        console.error("API error:", e);
        return -1; // foutmelding
      }
    }

    async function generateAndCheck() {
      const keyPair = bitcoin.ECPair.makeRandom();
      const { address } = bitcoin.payments.p2pkh({ pubkey: keyPair.publicKey });
      const wif = keyPair.toWIF();

      counter++;

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${counter}</td>
        <td>${address}</td>
        <td>${wif}</td>
        <td>...</td>
      `;
      tableBody.appendChild(row);

      const balance = await checkBalance(address);
      row.cells[3].textContent = balance >= 0 ? balance : "API fout";

      if (balance > 0) {
        row.classList.add('found');
        statusEl.textContent = `ðŸŽ‰ GEVONDEN! Adres: ${address} | WIF: ${wif}`;
        running = false;
        return true;
      } else {
        statusEl.textContent = `ðŸ”Ž Zoeken... (${counter} pogingen)`;
      }

      return false;
    }

    async function loop() {
      if (!running) return;
      const found = await generateAndCheck();
      if (!found && running) {
        setTimeout(loop, 500); // pauze om browser niet te blokkeren
      }
    }

    startBtn.addEventListener("click", () => {
      if (!running) {
        running = true;
        counter = 0;
        tableBody.innerHTML = "";
        statusEl.textContent = "ðŸš€ Start zoeken...";
        loop();
      }
    });

    stopBtn.addEventListener("click", () => {
      running = false;
      statusEl.textContent = "â›” Gestopt door gebruiker.";
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Ethereum Key Generator Sneller & Stabiel (GetBlock)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/elliptic/6.5.4/elliptic.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 8px; font-size: 14px; word-break: break-all; }
th { background: #f2f2f2; }
button, select, input { margin-bottom: 10px; padding: 8px 12px; }
#totaal, #errors, #progress { margin-bottom: 10px; font-weight: bold; }
#foundMsg { margin-top: 15px; font-weight: bold; font-size: 16px; color: green; }
label { display:inline-block; min-width: 210px; }
</style>
</head>
<body>
<h2>Ethereum Key Generator (Sneller & Stabiel via GetBlock)</h2>

<div id="totaal">Totaal gescande adressen: 0</div>
<div id="errors">Aantal errors: 0</div>
<div id="progress">Voortgang in keyspace: 0.000%</div>

<label for="modeSelect">Modus:</label>
<select id="modeSelect">
  <option value="inc-random-start">Incremental (random start)</option>
  <option value="inc-percent-start">Incremental (start % van keyspace)</option>
  <option value="random-each-step">Random (elke stap nieuwe key)</option>
</select>
<br>

<label for="startPercent">Start percentage (0â€“100):</label>
<input type="number" id="startPercent" value="0" min="0" max="100" step="0.0001">
<br>

<label for="stepPercent">Stap percentage:</label>
<input type="number" id="stepPercent" value="0.001" min="0.0000001" max="100" step="0.0000001">
<br>

<label for="batchSize">Batch grootte (max 50 aanbevolen):</label>
<input type="number" id="batchSize" value="10" min="1" max="50">
<br>

<button id="startBtn">Start zoeken</button>
<button id="stopBtn" disabled>Stop</button>
<button onclick="resetTeller()">Reset teller</button>
<button onclick="resetErrors()">Reset errors</button>

<div id="foundMsg"></div>

<table id="resultTable">
  <thead>
    <tr><th>#</th><th>Adres</th><th>Private Key (HEX)</th><th>Saldo (ETH)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ===== Helpers =====
function toHex(bytes){return Array.from(bytes).map(b=>b.toString(16).padStart(2,"0")).join("");}
function hexToBytes(hex){const out=new Uint8Array(hex.length/2);for(let i=0;i<out.length;i++) out[i]=parseInt(hex.substr(i*2,2),16);return out;}
function keccak256(bytes) {return CryptoJS.SHA3(CryptoJS.lib.WordArray.create(bytes), { outputLength: 256 }).toString();}
function toChecksumAddress(address) {
  address = address.toLowerCase().replace(/^0x/,"");
  const hash = keccak256(hexToBytes(address));
  let ret = "0x";
  for (let i=0;i<address.length;i++){ret += parseInt(hash[i],16) >= 8 ? address[i].toUpperCase() : address[i];}
  return ret;
}
function pubkeyToEthAddress(pubKeyBytes) {
  const hashHex = keccak256(pubKeyBytes.slice(1));
  const addressHex = hashHex.slice(-40);
  return toChecksumAddress(addressHex);
}

// ===== Keyspace =====
const ORDER_N = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141n;
const MIN_KEY = 1n;
const MAX_VALID_KEY = ORDER_N - 1n;
const KEYSPACE_SIZE = MAX_VALID_KEY;
let STEPS_PER_100_PERCENT = 100000n;
let carryNum = 0n;

// ===== Gen Key =====
function genRandomKeyBigInt(){
  const arr=new Uint8Array(32);
  crypto.getRandomValues(arr);
  let hex=toHex(arr);
  let k=BigInt("0x"+hex);
  if(k===0n) return 1n;
  if(k>MAX_VALID_KEY) k=(k % MAX_VALID_KEY)+1n;
  return k;
}
function percentToKey(perc){
  const steps = BigInt(Math.round(Math.min(100,Math.max(0,perc)) * Number(STEPS_PER_100_PERCENT)));
  const delta = (KEYSPACE_SIZE * steps) / STEPS_PER_100_PERCENT;
  return MIN_KEY + delta;
}

// ===== Variabelen =====
let counter=0, totaal=0, fouten=0;
let zoeken=false, MAX_VISIBLE=50;
let mode="inc-random-start", currentKey=null, firstKey=null;
let stepsDone=0n, startSteps=0n;

// ===== Balance check via GetBlock (batch met retries) =====
async function checkBalancesBatch(addresses, retries = 3) {
  try {
    const requests = addresses.map((addr, i) => ({
      jsonrpc: "2.0",
      method: "eth_getBalance",
      params: [addr, "latest"],
      id: i + 1
    }));

    let resp = await fetch("https://go.getblock.us/9624b720be854e75bcafb1d6040ff2d5", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(requests)
    });

    if (!resp.ok) throw new Error("HTTP " + resp.status);
    let data = await resp.json();

    return data.map(r => {
      if (r && r.result) {
        let wei = BigInt(r.result);
        return Number(wei) / 1e18;
      } else {
        fouten++;
        document.getElementById("errors").textContent = "Aantal errors: " + fouten;
        return "Error";
      }
    });

  } catch (e) {
    if (retries > 0) {
      console.warn("Retry saldo check, resterend:", retries, e.message);
      await new Promise(res => setTimeout(res, 500)); // 0.5s pauze
      return checkBalancesBatch(addresses, retries - 1);
    } else {
      fouten += addresses.length;
      document.getElementById("errors").textContent = "Aantal errors: " + fouten;
      return addresses.map(() => "Error");
    }
  }
}

// ===== Incremental step =====
function doOneIncrementalStep(){
  carryNum += KEYSPACE_SIZE;
  const inc = carryNum / STEPS_PER_100_PERCENT;
  carryNum %= STEPS_PER_100_PERCENT;
  currentKey += inc;
  if(currentKey > MAX_VALID_KEY) currentKey -= KEYSPACE_SIZE;
  stepsDone += 1n;
}

// ===== Genereer batch =====
async function genereerBatch(){
  if(!zoeken) return;
  const batchSize = Math.min(50, parseInt(document.getElementById("batchSize").value) || 10);
  const keys = [];
  for(let i=0;i<batchSize;i++){
    const k = mode==="random-each-step" ? genRandomKeyBigInt() : (currentKey, doOneIncrementalStep(), currentKey);
    keys.push(k);
  }

  const addresses = keys.map(k=>{
    const privHex = k.toString(16).padStart(64,"0");
    const ec = new elliptic.ec("secp256k1");
    const kp = ec.keyFromPrivate(privHex,"hex");
    const pubBytes = new Uint8Array(kp.getPublic(false,"array"));
    const ethAddr = pubkeyToEthAddress(pubBytes);
    return {address:ethAddr, priv:privHex};
  });

  const saldi = await checkBalancesBatch(addresses.map(a=>a.address));

  const tbody = document.querySelector("#resultTable tbody");
  for(let i=0;i<addresses.length;i++){
    counter++; totaal++;
    const saldo = saldi[i];
    const row = document.createElement("tr");
    row.innerHTML = `<td>${counter}</td><td>${addresses[i].address}</td><td>${addresses[i].priv}</td><td>${saldo}</td>`;
    if(typeof saldo==="number" && saldo>0){
      row.style.backgroundColor="#c8f7c5";
      document.getElementById("foundMsg").textContent=`Adres gevonden met saldo >0 ETH! ${addresses[i].address}`;
      stoppen();
    }
    tbody.appendChild(row);
  }
  while(tbody.rows.length>MAX_VISIBLE) tbody.deleteRow(0);

  document.getElementById("totaal").textContent="Totaal gescande adressen: "+totaal;
  const stepsDisplay = (startSteps + stepsDone) % STEPS_PER_100_PERCENT;
  const perc = Number(stepsDisplay) / Number(STEPS_PER_100_PERCENT) * 100;
  document.getElementById("progress").textContent="Voortgang in keyspace: "+perc.toFixed(6)+" %";

  if(zoeken) setTimeout(genereerBatch, 400); // interval tussen batches
}

// ===== Start / Stop / Reset =====
function starten(){
  if(zoeken) return;
  const stepPerc=parseFloat(document.getElementById("stepPercent").value)||0.001;
  STEPS_PER_100_PERCENT = BigInt(Math.round(100/stepPerc));
  carryNum=0n; stepsDone=0n; startSteps=0n;
  mode = document.getElementById("modeSelect").value;

  if(mode==="inc-random-start"){
    firstKey = genRandomKeyBigInt();
    currentKey = firstKey;
    startSteps = ((currentKey-MIN_KEY)*STEPS_PER_100_PERCENT)/KEYSPACE_SIZE;
  } else if(mode==="inc-percent-start"){
    const perc = parseFloat(document.getElementById("startPercent").value)||0;
    currentKey = percentToKey(perc);
    startSteps = BigInt(Math.round(perc*Number(STEPS_PER_100_PERCENT)/100));
  } else currentKey = genRandomKeyBigInt();

  zoeken = true;
  document.getElementById("startBtn").disabled = true;
  document.getElementById("stopBtn").disabled = false;
  document.getElementById("foundMsg").textContent="";
  genereerBatch();
}

function stoppen(){
  zoeken = false;
  document.getElementById("startBtn").disabled = false;
  document.getElementById("stopBtn").disabled = true;
}

function resetTeller(){totaal=0; counter=0; document.getElementById("totaal").textContent="Totaal gescande adressen: 0";}
function resetErrors(){fouten=0; document.getElementById("errors").textContent="Aantal errors: 0";}

document.getElementById("startBtn").addEventListener("click", starten);
document.getElementById("stopBtn").addEventListener("click", stoppen);
</script>
</body>
</html>
